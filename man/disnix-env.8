.TH "disnix-env" "8" "June 2009" "Disnix" "System administration tools"
.SH NAME
disnix\-env \- Installs or updates the enviroment of a distributed system
.SH SYNOPSIS
.B disnix\-env
\-s services_expr \-i infrastructure_expr \-d distribution_expr
[
.B options
]
.PP
.SH DESCRIPTION
The command \fBdisnix\-env\fR is used to install or upgrade a distributed system in a given environment.
This command requires three Nix expressions as input parameters; A services model capturing
the components of a distributed system and its inter-dependencies; A infrastructure model capturing
the machines in the network and its properties and a distribution model which maps services to machines.
.PP
By invoking this command it will first build all the services that are defined in the distribution
model from source code including all its dependencies. If all the services are successfully built,
the closures of the services are transferred to the target machines in the network. Finally, the
services are activated by traversing the inter-dependency graph of all the services.
In case of a failure a rollback is performed to bring the system back in its previous configuration.
.PP
When there is already a distributed system configuration deployed, an upgrade is performed. In this
phase only the changed parts of the system are deactivated and activated. In this process we
also deal with the inter-dependencies so that no services fails due to a missing inter-dependency.
.PP
Since the target machines could be of a different type or architecture as the coordinator machine,
we may not be able to build a specific service for the given target machine. In such cases,
\fBdisnix\-env\fR also provides the option to build the services on the target machines and to keep
the build results for further use.

.SH OPTIONS
.TP
\fB\-s\fR, \fB\-\-services\fR
Services Nix expression which describes all components of the distributed system
.TP
\fB\-i\fR, \fB\-\-infrastructure\fR
Infrastructure Nix expression which captures properties of machines in the network
.TP
\fB\-d\fR, \fB\-\-distribution\fR
Distribution Nix expression which maps services to machines in the network
.TP
\fB\-\-target\-property\fR
The target property of an infrastructure model, that specifies how to connect to the remote Disnix interface. (Defaults to hostname)
.TP
\fB\-\-interface\fR
Specifies which process provides access to the \fBdisnix\-service\fR on the target machine.
Defaults to: \fBdisnix\-client\fR.
.TP
\fB\-p\fR, \fB\-\-profile\fR
Name of the profile that is used for this system. Defaults to: default
.TP
\fB\-\-build\-on\-targets\fR
Build the services on the target machines in the network instead of managing the build by the coordinator.
.TP
\fB\-\-coordinator\-profile\-path\fR
Nix profile path where the manifest should be stored, so that Disnix knows the current configuration
of a distributed system. By default it is stored in the profile directory of the user.
Most users do not want to use this option directly, but it is used by e.g. the virtualization
extension to store virtual machine profile in a separate directory.
.TP
\fB\-\-show-trace\fR
Shows a trace of the output.
.TP
\fB\-h\fR, \fB\-\-help\fR
Shows the usage of this command to the user.
.SH ENVIRONMENT VARIABLES
.TP
\fBDISNIX_CLIENT_INTERFACE\fR
Sets the client interface (which defaults to \fBdisnix-ssh-client\fR)
.TP
\fBDISNIX_TARGET_PROPERTY\fR
Sets the target property of an infrastructure model, that specifies how to connect to the remote Disnix interface. (Defaults to hostname)
.SH SEE ALSO
.BR disnix-ssh-client (8)
.SH AUTHOR
Sander van der Burg <s.vanderburg@tudelft.nl>
